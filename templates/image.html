<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head
          content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="Dr. Dmitry A. Duev">

    <title>Robo-AO status images</title>

    <!-- Bootstrap core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/static/css/bootstrap-theme.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="/static/theme.css" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/static/robot-favicon.png" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>

    <script src="/static/js/bootstrap.min.js"></script>
    <!--
    <script src="//oss.maxcdn.com/bootbox/4.4.0/bootbox.min.js"></script>
    -->

    <!-- WS -->
    <script src="https://cdn.socket.io/socket.io-1.4.3.js"></script>
    <script>

        $(document).ready(function() {
            var ctx_dm = document.getElementById('canvas-dm').getContext('2d');
            ctx_dm.imageSmoothingEnabled = false;
            ctx_dm.webkitImageSmoothingEnabled = false;
            ctx_dm.msImageSmoothingEnabled = false;
            ctx_dm.mozImageSmoothingEnabled = false;

            var ctx_wfs = document.getElementById('canvas-wfs').getContext('2d');
            ctx_wfs.imageSmoothingEnabled = false;
            ctx_wfs.mozImageSmoothingEnabled = false;
            ctx_wfs.webkitImageSmoothingEnabled = false;
            ctx_wfs.msImageSmoothingEnabled = false;
            // flip vertically (as the png is somehow flipped):
            //ctx_wfs.translate(0, 300);
            //ctx_wfs.scale(1, -1);

            var ctx_vicd = document.getElementById('canvas-vicd').getContext('2d');
            ctx_vicd.imageSmoothingEnabled = false;
            ctx_vicd.mozImageSmoothingEnabled = false;
            ctx_vicd.webkitImageSmoothingEnabled = false;
            ctx_vicd.msImageSmoothingEnabled = false;

            var socket = io();

            socket.on('dm', function (info) {
                if (info.image) {
                    var img = new Image();
                    img.src = 'data:image/jpeg;base64,' + info.buffer;
                    ctx_dm.clearRect(0, 0, 300, 300);
                    ctx_dm.drawImage(img, 0, 0, 300, 300);
                }
            });

            socket.on('wfs', function (info) {
                if (info.image) {
                    var img = new Image();
                    img.src = 'data:image/jpeg;base64,' + info.buffer;
                    ctx_wfs.clearRect(0, 0, 300, 300);
                    ctx_wfs.drawImage(img, 0, 0, 300, 300);
                }
            });

            socket.on('vicd', function (info) {
                if (info.image) {
                    var img = new Image();
                    img.src = 'data:image/jpeg;base64,' + info.buffer;
                    ctx_vicd.drawImage(img, 0, 0, 600, 600);
                }
            });

        });
    </script>

    <script>

        // show/hide box
        function showHideBox() {

            if ($("#bx").css('display') != "none") {
                $("#bx").fadeOut();
            }
            else {
                $("#bx").fadeIn();
            }
        }

    </script>

    <style>
        @media only screen and (min-width: 930px) {
            /* wide screen: */
            #img-outer {
                width: 100%;
                text-align: center;
                margin: 0 auto;
            }
            #img-inner {
                width: 900px;
                display: inline-block;
                margin: 0;
                padding: 0;
            }
            #canvas-dm {
                position:relative;
                left:-300px;
                margin: 0;
                padding: 0;
            }
            #canvas-wfs {
                transform: scaleY(-1);
                display: block;
                position: relative;
                top: -3px;
                margin: 0;
                padding: 0;
            }
            #canvas-vicd {
                position: relative;
                right:-152px;
                height: 600px;
                top: -13px;
                margin-top:-600px;
            }

            .box {
                z-index: 100;
                display: block;
                width: 36px;
                height: 36px;
                position: relative;
                left: 584px;
                margin-top:-336px;
                /* Safari 3-4, iOS 1-3.2, Android 1.6- */
                -webkit-border-radius: 12px;

                /* Firefox 1-3.6 */
                -moz-border-radius: 12px;

                /* Opera 10.5, IE 9, Safari 5, Chrome, Firefox 4, iOS 4, Android 2.1+ */
                border-radius: 50%;

                border: 3px solid #BADA55;
            }
        }
        @media only screen and (max-width: 930px) {
            /* narrow screen: */
            #img-outer {
                width: 100%;
                text-align: center;
                margin: 0 auto;
            }
            #img-inner {
                width: 600px;
                height: 950px;
                display: inline-block;
                margin: 0;
                padding: 0;
            }
            #canvas-dm {
                position:relative;
                left:-150px;
                margin: 0;
                padding: 0;
            }
            #canvas-wfs {
                transform: scaleY(-1);
                display: block;
                position: relative;
                top: -303px;
                left: 300px;
                margin: 0;
                padding: 0;
            }
            #canvas-vicd {
                position: relative;
                right:0px;
                height: 600px;
                top: 290px;
                margin-top:-600px;
            }

            .box {
                z-index: 100;
                display: block;
                width: 36px;
                height: 36px;
                position: relative;
                left: 282px;
                margin-top: -32px;
                /* Safari 3-4, iOS 1-3.2, Android 1.6- */
                -webkit-border-radius: 12px;

                /* Firefox 1-3.6 */
                -moz-border-radius: 12px;

                /* Opera 10.5, IE 9, Safari 5, Chrome, Firefox 4, iOS 4, Android 2.1+ */
                border-radius: 50%;

                border: 3px solid #BADA55;
            }
        }


    </style>

</head>

<!-- Fixed navbar -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed"
                    data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Robo-AO</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="/">Status</a></li>
                <li class="active"><a href="#">Images</a></li>
                <li><a href="http://www.oir.caltech.edu/twiki_oir/bin/viewauth/Palomar/RoboAO/WebHome">Twiki</a></li>
                <li class="dropdown" style="display:none">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"
                       role="button" aria-haspopup="true"
                       aria-expanded="false">Dropdown <span class="caret"></span></a>
                    <ul class="dropdown-menu">
                        <li><a href="#">Action</a></li>
                        <li><a href="#">Another action</a></li>
                        <li><a href="#">Something else here</a></li>
                        <li role="separator" class="divider"></li>
                        <li class="dropdown-header">Nav header</li>
                        <li><a href="#">Separated link</a></li>
                        <li><a href="#">One more separated link</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<body role="document">



<div class="container theme-showcase" role="main">

    <div class="page-header" style="margin-top:-30px;">
        <h3>Robo-AO images</h3>
    </div>

    <div id="img-outer">
        <div id="img-inner">
            <canvas id="canvas-dm" width="300px" height="300px"></canvas>
            <canvas id="canvas-wfs" width="300px" height="300px"></canvas>
            <canvas id="canvas-vicd" width="600px" height="600px" onClick="showHideBox();"></canvas>
            <div class="box" id="bx"></div>
        </div>

    </div>
    <br><br>

</div>

</body>

</html>
